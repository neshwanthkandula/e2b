FROM node:20-alpine

# Install tools needed for builds + dev servers
RUN apk add --no-cache \
    bash \
    git \
    curl \
    vim \
    sudo \
    python3 \
    make \
    g++ \
    openssh-client \
    tini

# Enable corepack
RUN corepack enable && \
    corepack prepare yarn@stable --activate && \
    corepack prepare pnpm@latest --activate

# PM2 = keeps dev server alive without needing nohup hacks
RUN npm install -g pm2

WORKDIR /workspace

# Vite dev server uses port 3000
EXPOSE 3000

# Use tini as PID 1 â†’ prevents zombie processes
ENTRYPOINT ["/sbin/tini", "--"]

# Keep the container alive indefinitely
CMD ["sh", "-c", "while true; do sleep 3600; done"]
